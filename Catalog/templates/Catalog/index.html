{% extends 'layout.html' %}
{% block body %}
<div class="container">
  <form class="row mt-3">
    <div class="col-12">
      <label class="visually-hidden" for="inlineFormInputGroupUsername">Busca en nuestro catalogo</label>
      <div class="input-group">
        <div class="input-group-text bg-white"><span class="material-icons" style="color: #e1c2c1;">
            search
          </span></div>
        <input type="text" class="form-control border-start-0" id="inlineFormInputGroupUsername"
          placeholder="Busca en nuestro catÃ¡logo" oninput="delayedSearch(this.value)">

      </div>
    </div>
  </form>
  <div class="row mt-3">
    <div class="col-12">
      <h2>Nuestros productos!</h2>
    </div>
  </div>
  <div class="row mt-2 gy-4" id="cardHolder">

  </div>
</div>

<script>



  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');

  let timer;
  function delayedSearch(keyword) {
    clearTimeout(timer);
    timer = setTimeout(function () {
      getCards(keyword);
    }, 500); // Set the desired delay in milliseconds (e.g., 500ms)
  }


  function getCards(search) {
    console.log(search);
    document.getElementById('cardHolder').innerHTML = `<div class="col-12 col-sm-3">
    <div class="card" aria-hidden="true">
        <svg class="bd-placeholder-img card-img-top" width="100%" height="180" xmlns="http://www.w3.org/2000/svg"
            role="img" aria-label="Placeholder" preserveAspectRatio="xMidYMid slice" focusable="false">
            <title>Placeholder</title>
            <rect width="100%" height="100%" fill="#868e96"></rect>
        </svg>
        <div class="card-body">
            <h5 class="card-title placeholder-glow">
                <span class="placeholder col-6"></span>
            </h5>
            <p class="card-text placeholder-glow">
                <span class="placeholder col-7"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-6"></span>
                <span class="placeholder col-8"></span>
            </p>
            <div class="mt-auto text-end">
                <a href="#" tabindex="-1" class="btn btn-antheaPink disabled placeholder col-6"></a>
            </div>
        </div>
    </div>
</div>
<div class="col-12 col-sm-3">
    <div class="card" aria-hidden="true">
        <svg class="bd-placeholder-img card-img-top" width="100%" height="180" xmlns="http://www.w3.org/2000/svg"
            role="img" aria-label="Placeholder" preserveAspectRatio="xMidYMid slice" focusable="false">
            <title>Placeholder</title>
            <rect width="100%" height="100%" fill="#868e96"></rect>
        </svg>
        <div class="card-body">
            <h5 class="card-title placeholder-glow">
                <span class="placeholder col-6"></span>
            </h5>
            <p class="card-text placeholder-glow">
                <span class="placeholder col-7"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-6"></span>
                <span class="placeholder col-8"></span>
            </p>
            <div class="mt-auto text-end">
                <a href="#" tabindex="-1" class="btn btn-antheaPink disabled placeholder col-6"></a>
            </div>
        </div>
    </div>
</div>
<div class="col-12 col-sm-3">
    <div class="card" aria-hidden="true">
        <svg class="bd-placeholder-img card-img-top" width="100%" height="180" xmlns="http://www.w3.org/2000/svg"
            role="img" aria-label="Placeholder" preserveAspectRatio="xMidYMid slice" focusable="false">
            <title>Placeholder</title>
            <rect width="100%" height="100%" fill="#868e96"></rect>
        </svg>
        <div class="card-body">
            <h5 class="card-title placeholder-glow">
                <span class="placeholder col-6"></span>
            </h5>
            <p class="card-text placeholder-glow">
                <span class="placeholder col-7"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-6"></span>
                <span class="placeholder col-8"></span>
            </p>
            <div class="mt-auto text-end">
                <a href="#" tabindex="-1" class="btn btn-antheaPink disabled placeholder col-6"></a>
            </div>
        </div>
    </div>
</div>
<div class="col-12 col-sm-3">
    <div class="card" aria-hidden="true">
        <svg class="bd-placeholder-img card-img-top" width="100%" height="180" xmlns="http://www.w3.org/2000/svg"
            role="img" aria-label="Placeholder" preserveAspectRatio="xMidYMid slice" focusable="false">
            <title>Placeholder</title>
            <rect width="100%" height="100%" fill="#868e96"></rect>
        </svg>
        <div class="card-body">
            <h5 class="card-title placeholder-glow">
                <span class="placeholder col-6"></span>
            </h5>
            <p class="card-text placeholder-glow">
                <span class="placeholder col-7"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-4"></span>
                <span class="placeholder col-6"></span>
                <span class="placeholder col-8"></span>
            </p>
            <div class="mt-auto text-end">
                <a href="#" tabindex="-1" class="btn btn-antheaPink disabled placeholder col-6"></a>
            </div>
        </div>
    </div>
</div>`
    fetch(`Ajax/Search`, {
      method: 'POST',
      credentials: 'same-origin',
      headers: {
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest',
        'X-CSRFToken': csrftoken,
      },
      body: JSON.stringify({ 'jsonBody': { "search": search } })
    })
      .then(response => response.text())
      .then(text => {

        document.getElementById('cardHolder').innerHTML = text
      })
  }

  document.addEventListener('DOMContentLoaded', function () {
    getCards("");
  });
</script>
{% endblock %}